<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>pra minha lalinha</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {--bg:#000;--text:#fff;}
  *{margin:0;padding:0;box-sizing:border-box;}
  html,body{
    height:100%;width:100%;
    background:var(--bg);color:var(--text);
    font-family:'Inter',sans-serif;
    overflow:hidden;display:flex;align-items:center;justify-content:center;
  }
  #start{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    background:#000;z-index:10;flex-direction:column;
  }
  #start button{
    font-size:1.1rem;font-weight:600;
    color:#000;background:#fff;border:none;border-radius:8px;
    padding:14px 32px;cursor:pointer;transition:transform .3s ease;
  }
  #start button:hover{transform:scale(1.05);}
  .stage{
    position:absolute;inset:0;
    display:flex;align-items:center;justify-content:center;
    flex-direction:column;overflow:hidden;
  }
  .img-bg{
    position:absolute;inset:0;
    display:flex;align-items:center;justify-content:center;
    z-index:0;
  }
  .img-bg img{
    width:85%;max-width:800px;border-radius:10px;
    opacity:0;transition:opacity 3s ease;
    box-shadow:0 30px 80px rgba(0,0,0,.6);
    position:absolute;
  }
  .overlay{
    position:absolute;inset:0;
    background:linear-gradient(180deg,rgba(0,0,0,0.5),rgba(0,0,0,0.9));
    z-index:1;pointer-events:none;
  }
  .text{
    position:relative;
    z-index:2;
    font-size:1.2rem;
    text-align:center;
    width:90%;
    max-width:700px;
    color:#fff;
    text-shadow:0 0 8px rgba(0,0,0,0.8);
    height:5em;
  }
  .fade-end{
    position:absolute;inset:0;
    background:#000;
    opacity:0;transition:opacity 2s ease;
    z-index:5;
    display:flex;align-items:center;justify-content:center;
    flex-direction:column;
  }
  .fade-end.show{opacity:1;}
  .final-text{
    font-size:1.2rem;
    opacity:0;
    color:#fff;
    font-weight:600;
    letter-spacing:0.5px;
    animation:fadeInText 6s ease forwards;
    animation-delay:1s;
    white-space:pre-line;
    text-align:center;
  }
  @keyframes fadeInText{to{opacity:1;}}
</style>
</head>
<body>

<div id="start">
  <button id="beginBtn">começar</button>
</div>

<div class="stage">
  <div class="img-bg">
    <img src="foto1.jpg" alt="">
    <img src="foto2.jpg" alt="">
    <img src="foto3.jpg" alt="">
    <img src="foto4.jpg" alt="">
    <img src="foto5.jpg" alt="">
    <img src="foto6.jpg" alt="">
  </div>
  <div class="overlay"></div>
  <div class="text" id="text"></div>
  <div class="fade-end" id="fadeEnd">
    <div class="final-text" id="finalText"></div>
  </div>
</div>

<script>
const btn = document.getElementById('beginBtn');
const startScreen = document.getElementById('start');
const textEl = document.getElementById('text');
const imgs = [...document.querySelectorAll('.img-bg img')];
const fadeEnd = document.getElementById('fadeEnd');
const finalText = document.getElementById('finalText');

const typeSpeed = 45;
const eraseSpeed = 30;
const pauseTime = 2500;

const messages = [
  "pra minha lalinha.\nou larovski. namurada. paixão. amô. nabinho.",
  "é tão leve com você que até parece estranho tentar escrever algo sério.\nparece que nos conhecemos há tanto tempo que até esqueço que teve um antes.",
  "seis meses, paixão.\nseis meses que a gente se tem e a minha vida já não existe mais sem você dentro dela.",
  "penso nas viagens que ainda temos pra fazer,\nnos filmes que prometemos ver e sempre deixamos pra depois.",
  "você me faz sentir inteiro.\nmais que isso, compreendido.\nme sinto no meu lugar. com você.",
  "te amo mais que tudo, paixão."
];

const finalMessage = "obrigado por me existir,\npor me amar\ne por me fazer feliz.\n\n— seu eterno tomatinho";

function wait(ms){return new Promise(r=>setTimeout(r,ms));}
async function typeText(msg){
  textEl.textContent = "";
  for(let char of msg){ textEl.textContent += char; await wait(typeSpeed);}
  await wait(pauseTime);
  for(let i=msg.length;i>=0;i--){ textEl.textContent = msg.slice(0,i); await wait(eraseSpeed);}
}

async function keepAwake(){
  try { if('wakeLock' in navigator) await navigator.wakeLock.request('screen'); } catch(e){}
}

let audioCtx, gainNode, sourceNode;

async function playWithControlledVolume() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const response = await fetch('musica.mp3');
  const arrayBuffer = await response.arrayBuffer();
  const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
  
  sourceNode = audioCtx.createBufferSource();
  sourceNode.buffer = audioBuffer;

  gainNode = audioCtx.createGain();
  gainNode.gain.value = 0.35; // volume suave

  sourceNode.connect(gainNode);
  gainNode.connect(audioCtx.destination);

  sourceNode.start(0);
  return audioBuffer.duration * 1000;
}

function startImageLoop(startTime,totalDuration){
  const imgCount = imgs.length;
  const segment = totalDuration / imgCount;

  function update(){
    const elapsed = performance.now() - startTime;
    const idx = Math.min(imgCount - 1, Math.floor(elapsed / segment));
    const progress = (elapsed % segment) / segment;

    imgs.forEach((img,i)=>{
      if(i === idx) img.style.opacity = 1;
      else if(i === idx - 1 && progress < 0.3) img.style.opacity = 1 - progress * 3.3;
      else img.style.opacity = 0;
    });

    if(elapsed < totalDuration) requestAnimationFrame(update);
  }
  requestAnimationFrame(update);
}

async function startShow(){
  keepAwake();
  startScreen.style.display='none';
  const totalDuration = await playWithControlledVolume();
  const startTime = performance.now();
  startImageLoop(startTime,totalDuration);

  for(let msg of messages){ await typeText(msg); }

  fadeEnd.classList.add('show');
  finalText.textContent="";
  for(let c of "obrigado por me existir,\npor me amar\ne por me fazer feliz.\n\n— seu eterno tomatinho"){ 
    finalText.textContent += c; 
    await wait(70); 
  }
}

btn.onclick = ()=>startShow();
</script>
</body>
</html>
